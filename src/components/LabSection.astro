---
// Fetch articles from Dev.to API
let articles: any[] = [];
try {
    const response = await fetch('https://dev.to/api/articles?username=altaskur&per_page=5');
    if (response.ok) {
        articles = await response.json();
    }
} catch (e) {
    console.error("Failed to fetch dev.to articles", e);
}

// Fallback if no articles
if (articles.length === 0) {
    articles = [
        { 
            title: "Building Accessible Components in Angular", 
            url: "#", 
            published_at: "2026-01-15", 
            tag_list: ["angular", "accessibility", "typescript"],
            description: "Best practices for creating WCAG-compliant components that work for everyone.",
            cover_image: "https://dev-to-uploads.s3.amazonaws.com/uploads/articles/example1.jpg"
        },
        { 
            title: "TypeScript Patterns for Scalable Frontends", 
            url: "#", 
            published_at: "2025-12-20", 
            tag_list: ["typescript", "architecture", "react"],
            description: "Exploring design patterns that help frontend codebases evolve gracefully.",
            cover_image: "https://dev-to-uploads.s3.amazonaws.com/uploads/articles/example2.jpg"
        },
        { 
            title: "From Code to Community: Why I Started Streaming", 
            url: "#", 
            published_at: "2025-11-10", 
            tag_list: ["community", "career", "learning"],
            description: "How sharing code publicly became a tool for learning and growing as a developer.",
            cover_image: "https://dev-to-uploads.s3.amazonaws.com/uploads/articles/example3.jpg"
        }
    ];
}

// Proxy function to avoid third-party cookies from Dev.to
const getProxyImage = (url: string) => {
    if (!url) return null;
    // Use wsrv.nl as a privacy-friendly image proxy
    return `https://wsrv.nl/?url=${encodeURIComponent(url)}&w=800&q=80`;
};
---

<section id="blog" class="px-4 py-20 md:px-10">
    <div class="mb-16 flex items-end justify-between">
        <h2 class="text-3xl font-bold text-white md:text-5xl"><span class="text-accent">03.</span> The Blog</h2>
        <a href="https://dev.to/altaskur" target="_blank" class="hidden font-mono text-sm text-gray-500 hover:text-accent transition-colors md:block">/// DEV.TO ARTICLES</a>
    </div>

    <div class="space-y-32">
        {articles.slice(0, 3).map((article: any, index: number) => (
            <article class="lab-card relative grid gap-10 md:grid-cols-2 items-center opacity-0 translate-y-20">
                <div class={`space-y-6 ${index % 2 === 1 ? 'md:order-2' : ''}`}>
                    <div class="flex items-center gap-4 text-accent font-mono text-sm">
                        <span>0{index + 1}</span>
                        <span class="h-px w-10 bg-accent"></span>
                        <span>{(article.tag_list || []).slice(0, 3).join(" / ")}</span>
                    </div>
                    
                    <a href={article.url} target="_blank" rel="noopener noreferrer" class="block group/title">
                        <h3 class="text-3xl font-bold text-white md:text-4xl group-hover/title:text-accent transition-colors">{article.title}</h3>
                    </a>
                    <p class="text-lg text-gray-400">{article.description || "Read the full article on Dev.to"}</p>
                    
                    <div class="flex items-center gap-6 pt-4">
                        <a href={article.url} target="_blank" class="text-sm font-bold text-white hover:text-accent transition-colors flex items-center gap-2">
                            READ_ARTICLE 
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>
                        </a>
                        <span class="text-sm font-mono text-gray-600">{new Date(article.published_at).toLocaleDateString()}</span>
                    </div>
                </div>

                <a href={article.url} target="_blank" rel="noopener noreferrer" class={`relative aspect-video overflow-hidden rounded-lg bg-gray-900 border border-gray-800 group block ${index % 2 === 1 ? 'md:order-1' : ''}`}>
                    {article.cover_image ? (
                        <img 
                            src={getProxyImage(article.cover_image)} 
                            alt={article.title} 
                            class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" 
                            loading="lazy"
                        />
                    ) : (
                        <div class="absolute inset-0 flex items-center justify-center bg-[#0a0a0a] group-hover:bg-black transition-colors">
                            <div class="transform group-hover:scale-110 transition-transform duration-300">
                                <img src="/assets/devto-icon.png" alt="Dev.to Logo" class="w-16 h-16 object-contain" />
                            </div>
                            <span class="absolute bottom-4 font-mono text-xs text-gray-500 group-hover:text-white transition-colors">./article_{index + 1}.md</span>
                        </div>
                    )}
                </a>
            </article>
        ))}
    </div>
    
    <div class="mt-16 text-center">
        <a href="https://dev.to/altaskur" target="_blank" class="group relative inline-flex items-center gap-2 overflow-hidden rounded-lg bg-gray-800/50 px-8 py-4 text-sm font-mono text-white ring-1 ring-gray-700 transition-all hover:bg-gray-800 hover:ring-accent focus:outline-none focus:ring-2 focus:ring-accent">
            <span class="relative z-10 flex items-center gap-2 font-bold tracking-wider">
                VIEW MORE ON DEV.TO
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:translate-x-1"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
            </span>
            <div class="absolute inset-0 -z-10 bg-gradient-to-r from-accent/10 to-transparent opacity-0 transition-opacity group-hover:opacity-100"></div>
        </a>
    </div>
</section>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    gsap.registerPlugin(ScrollTrigger);

    const initBlogAnimations = () => {
        const cards = document.querySelectorAll('.lab-card');

        cards.forEach((card) => {
            gsap.to(card, {
                y: 0,
                opacity: 1,
                duration: 1,
                ease: "power3.out",
                scrollTrigger: {
                    trigger: card,
                    start: "top 80%",
                    end: "bottom 20%",
                    toggleActions: "play none none reverse"
                }
            });
        });
    };

    document.addEventListener('astro:page-load', initBlogAnimations);
    document.addEventListener('DOMContentLoaded', initBlogAnimations);
    
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(initBlogAnimations, 100);
    }
</script>
